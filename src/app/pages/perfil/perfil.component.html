<!-- src/app/pages/perfil/perfil.component.html -->
<section class="perfil">
  <!-- Header de perfil (igual que antes) -->
  <div class="card info-card">
    <div class="info-grid">
      <div class="kvs">
        <!-- Nombre + Apellido -->
        <div class="kv">
          <span class="k">Nombre</span>
          <span class="v" *ngIf="!editMode">{{ nombreCompleto }}</span>
          <span class="v v-edit" *ngIf="editMode">
            <input
              class="inline-input"
              [(ngModel)]="editable.nombre"
              placeholder="Nombre"
            />
            <input
              class="inline-input"
              [(ngModel)]="editable.apellido"
              placeholder="Apellido"
            />
          </span>
        </div>

        <!-- Carrera -->
        <div class="kv">
          <span class="k">Carrera/s en curso</span>
          <span class="v" *ngIf="!editMode">{{ editable.carrera }}</span>
          <span class="v v-edit" *ngIf="editMode">
            <input
              class="inline-input"
              [(ngModel)]="editable.carrera"
              placeholder="Carrera"
            />
          </span>
        </div>

        <!-- Semestre -->
        <div class="kv">
          <span class="k">Semestre máximo</span>
          <span class="v" *ngIf="!editMode">{{ semestreLabel }}</span>
          <span class="v v-edit" *ngIf="editMode">
            <input
              class="inline-input"
              type="number"
              min="1"
              [(ngModel)]="editable.semestre"
            />
          </span>
        </div>

        <!-- Teléfono -->
        <div class="kv">
          <span class="k">Teléfono</span>
          <span class="v" *ngIf="!editMode">{{ editable.telefono }}</span>
          <span class="v v-edit" *ngIf="editMode">
            <input
              class="inline-input"
              [(ngModel)]="editable.telefono"
              placeholder="Teléfono"
            />
          </span>
        </div>

        <!-- Roles (solo lectura) -->
        <div class="kv">
          <span class="k">Roles</span>
          <span class="v">{{ rolPrincipal }}</span>
        </div>

        <!-- Email -->
        <div class="kv">
          <span class="k">Email</span>
          <span class="v" *ngIf="!editMode">{{ editable.email }}</span>
          <span class="v v-edit" *ngIf="editMode">
            <input
              class="inline-input"
              [(ngModel)]="editable.email"
              placeholder="Email"
            />
          </span>
        </div>

        <!-- Ubicación -->
        <div class="kv">
          <span class="k">Ubicación</span>
          <span class="v" *ngIf="!editMode">{{ editable.ubicacion }}</span>
          <span class="v v-edit" *ngIf="editMode">
            <input
              class="inline-input"
              [(ngModel)]="editable.ubicacion"
              placeholder="Ubicación"
            />
          </span>
        </div>
      </div>
    </div>

    <!-- Botones editar / guardar / cancelar -->
    <div class="info-actions">
      <button
        class="btn btn-sm edit"
        *ngIf="!editMode"
        (click)="editarPerfil()"
        title="Editar"
      >
        Editar ✎
      </button>

      <ng-container *ngIf="editMode">
        <button
          class="btn btn-sm primary"
          [disabled]="saving"
          (click)="guardarPerfil()"
        >
          {{ saving ? "Guardando..." : "Guardar" }}
        </button>
        <button class="btn btn-sm ghost" (click)="cancelarEdicion()">
          Cancelar
        </button>
      </ng-container>
    </div>

    <p class="msg ok" *ngIf="saveMsg">{{ saveMsg }}</p>
    <p class="msg error" *ngIf="errorMsg">{{ errorMsg }}</p>
  </div>

  <!-- Grid principal: Portafolio / Evidencias / Sobre mí -->
  <div class="grid-3">
    <!-- Resumen Portafolio (solo lectura) -->
    <section class="card panel">
      <header class="panel-header">
        <h2>Portafolio</h2>
      </header>

      <ng-container *ngIf="!loadingPortafolio && portafolio; else loadingPort">
        <p class="pf-label">Descripción</p>
        <p class="pf-text">
          {{ portafolio.descripcion || "Sin descripción aún." }}
        </p>

        <p class="pf-label">Skills</p>
        <p class="pf-text">
          {{ portafolio.skills || "Sin skills cargados." }}
        </p>

        <p class="pf-label">Visibilidad</p>
        <p>
          <span
            class="pill-visibilidad"
            [class.publico]="portafolio.visibilidad"
          >
            {{ portafolio.visibilidad ? "Visible para empresas" : "Privado" }}
          </span>
        </p>

        <a
          routerLink="/portafolio"
          class="link-portafolio"
          title="Ir a la pantalla de Portafolio"
        >
          Ver y editar portafolio →
        </a>
      </ng-container>

      <ng-template #loadingPort>
        <p class="pf-text">Cargando portafolio...</p>
      </ng-template>
    </section>

    <!-- Evidencias (solo lectura) -->
    <section class="card panel">
      <header class="panel-header">
        <h2>Evidencias</h2>
      </header>

      <div class="lista-evidencias">
        <ng-container
          *ngIf="!loadingEvidencias && evidencias.length; else noEvidencias"
        >
          <article class="evidencia-card" *ngFor="let e of evidencias">
            <header class="ev-header-main">
              <h3>{{ e.titulo }}</h3>
              <span class="chip" *ngIf="e.tipo">{{ e.tipo }}</span>
            </header>
            <p class="desc">{{ e.descripcion }}</p>
            <p class="recurso" *ngIf="e.recurso">
              Recurso: <span>{{ e.recurso }}</span>
            </p>
          </article>
        </ng-container>

        <ng-template #noEvidencias>
          <p class="empty">Todavía no registraste evidencias.</p>
        </ng-template>
      </div>
    </section>

    <!-- Endorsement -->
    <aside class="card panel">
      <header class="panel-header">
        <h2>Endorsement</h2>
        <p class="endorsement-subtitle">
          Comentarios y validaciones que recibiste sobre tus skills.
        </p>
      </header>

      <div class="about endorsements">
        <ng-container *ngIf="!loadingEndorsements; else loadingEndorse">
          <ng-container *ngIf="endorsements.length; else noEndorsements">
            <article class="endorsement-card" *ngFor="let e of endorsements">
              <header class="endorsement-header">
                <span class="skill-pill">
                  {{ e.skill || "Skill sin nombre" }}
                </span>
                <span
                  class="status-pill"
                  [ngClass]="'status-' + (e.status || '').toLowerCase()"
                >
                  {{ e.status }}
                </span>
              </header>

              <p class="endorsement-message">
                “{{ e.message || "Sin mensaje proporcionado." }}”
              </p>

              <p class="endorsement-from">
                Endorsed by usuario #{{ e.fromUserId }}
              </p>
            </article>
          </ng-container>

          <ng-template #noEndorsements>
            <p class="empty">Todavía no recibiste endorsements.</p>
          </ng-template>

          <p class="msg error" *ngIf="endorsementsError">
            {{ endorsementsError }}
          </p>
        </ng-container>

        <ng-template #loadingEndorse>
          <p class="pf-text">Cargando endorsements...</p>
        </ng-template>
      </div>
    </aside>
  </div>
</section>
