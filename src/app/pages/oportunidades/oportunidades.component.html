<section class="opp">
  <!-- filtros -->
  <aside class="filters card">
    <h2 class="filters-title">FILTROS</h2>

    <div class="view-switch">
      <button
        class="view-btn"
        [class.active]="viewMode === 'oportunidades'"
        (click)="setViewMode('oportunidades')"
      >
        Oportunidades acadÃ©micas
      </button>
      <button
        class="view-btn"
        [class.active]="viewMode === 'bolsa'"
        (click)="setViewMode('bolsa')"
      >
        Bolsa de trabajo
      </button>
    </div>

    <div class="filters-group" *ngFor="let k of kinds">
      <button
        class="filters-kind"
        [class.active]="selectedKind === k"
        (click)="setKind(selectedKind === k ? null : k)"
      >
        {{ k }}
      </button>

      <ul class="career-list">
        <li *ngFor="let m of modalidades" class="career-item">
          <span class="dot" [style.background]="modalidadColor(m)"></span>
          <button
            class="career-btn"
            [class.on]="isModalidadSelected(m)"
            (click)="toggleModalidad(m)"
          >
            {{ m }}
          </button>
        </li>
      </ul>
    </div>
  </aside>

  <!-- contenido principal -->
  <section class="content card">
    <header class="content-header">
      <h1>
        {{
          viewMode === "oportunidades" ? "OPORTUNIDADES" : "BOLSA DE TRABAJO"
        }}
      </h1>
      <div class="search">
        <span class="icon">ðŸ”Ž</span>
        <input
          type="text"
          [(ngModel)]="search"
          placeholder="Buscar por tÃ­tulo, tipo, modalidad, empresa o ubicaciÃ³n..."
          aria-label="Buscar oportunidad"
        />
      </div>
    </header>

    <div class="grid">
      <article
        class="opp-card"
        *ngFor="let o of list"
        [style.--band]="modalidadColor(o.modalidad)"
        [class.is-job]="o.origin === 'bolsaTrabajo'"
        [class.is-academic]="o.origin === 'oportunidad'"
      >
        <div class="opp-band">
          <!-- tÃ­tulo principal (nombre de la oferta) -->
          <span class="career">{{ o.title }}</span>
          <span class="sep">â€”</span>
          <span class="kind">{{ o.kind }}</span>

          <!-- badge de origen -->
          <span
            class="origin-badge"
            *ngIf="o.origin === 'bolsaTrabajo'; else origenAcademico"
          >
            Bolsa de trabajo
          </span>
          <ng-template #origenAcademico>
            <span class="origin-badge origin-badge--academic">
              Oportunidad acadÃ©mica
            </span>
          </ng-template>
        </div>

        <div class="opp-body">
          <div class="info">
            <strong class="title">
              {{ o.modalidad }}
              <ng-container *ngIf="o.empresa"> Â· {{ o.empresa }} </ng-container>
            </strong>

            <small class="meta" *ngIf="o.ubicacion">
              UbicaciÃ³n: {{ o.ubicacion }}
            </small>

            <small class="meta">{{ o.estado }}</small>
            <small class="meta">
              Cierra: {{ o.fechaCierre | date : "dd/MM/yyyy HH:mm" }}
            </small>

            <small class="meta" *ngIf="o.aplicado">
              Ya estÃ¡s postulado a esta oportunidad.
            </small>
          </div>

          <div class="cta">
            <button
              class="btn"
              [disabled]="!canApply(o)"
              (click)="inscribirse(o)"
            >
              <ng-container *ngIf="o.aplicado; else notApplied">
                Ya postulado
              </ng-container>
              <ng-template #notApplied>
                {{ isApplying(o) ? "Postulando..." : "Inscribirse" }}
              </ng-template>
            </button>
          </div>
        </div>
      </article>
    </div>

    <p class="ok" *ngIf="applyMsg">
      {{ applyMsg }}
    </p>

    <p class="error" *ngIf="errorMsg">
      {{ errorMsg }}
    </p>
  </section>
</section>
